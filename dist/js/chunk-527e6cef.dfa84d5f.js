(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-527e6cef"],{"0b34":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return!0===e.showForm?a("div",{staticClass:"box"},[a("van-cell-group",[a("van-cell",{attrs:{title:e.detail.name,label:e.detail.desc,"title-class":"title"}}),a("van-field",{attrs:{clearable:"",clickable:!1,placeholder:e.detail.payAmt,"input-align":"right","label-width":"110",label:"冻结金额",readonly:""},model:{value:e.detail.payAmt,callback:function(t){e.$set(e.detail,"payAmt",t)},expression:"detail.payAmt"}}),a("van-field",{attrs:{clearable:"",clickable:!1,type:"digit",placeholder:e.detail.num+"期","input-align":"right","label-width":"110",label:"套餐期数",readonly:""},model:{value:e.detail.num,callback:function(t){e.$set(e.detail,"num",t)},expression:"detail.num"}}),a("van-field",{attrs:{clearable:"",clickable:!1,placeholder:"请输入客户姓名","input-align":"right","label-width":"110",label:"客户姓名"},model:{value:e.customerName,callback:function(t){e.customerName="string"===typeof t?t.trim():t},expression:"customerName"}}),a("van-field",{attrs:{clearable:"",clickable:!1,type:"tel",maxlength:"11",placeholder:"请输入办理业务手机号","input-align":"right","label-width":"110",label:"客户手机号"},model:{value:e.customerPhone,callback:function(t){e.customerPhone="string"===typeof t?t.trim():t},expression:"customerPhone"}}),a("van-field",{attrs:{clearable:"",clickable:!1,maxlength:"18",placeholder:"请输入身份证号","input-align":"right","label-width":"110",label:"客户身份证号"},model:{value:e.customerCertNo,callback:function(t){e.customerCertNo="string"===typeof t?t.trim():t},expression:"customerCertNo"}}),"请选择营业员"==e.cashier?a("van-cell",{attrs:{title:"选择营业员","is-link":"",value:e.cashier},on:{click:e.showCashier}}):a("van-field",{attrs:{"is-link":"",value:e.cashier,"input-align":"right","label-width":"110",label:"选择营业员"},on:{click:e.showCashier}}),a("van-popup",{attrs:{position:"bottom"},model:{value:e.showPicker,callback:function(t){e.showPicker=t},expression:"showPicker"}},[a("van-picker",{attrs:{"show-toolbar":"",columns:e.cashierList,"value-key":"name"},on:{cancel:function(t){e.showPicker=!1},confirm:e.onConfirm},model:{value:e.cashier,callback:function(t){e.cashier=t},expression:"cashier"}})],1)],1),1==e.openImgState?a("van-cell-group",{staticStyle:{"margin-top":"10px"}},[a("van-row",{attrs:{type:"flex",justify:"space-between"}},[a("van-col",{staticClass:"upload-left",attrs:{span:"10"}},[a("p",{staticClass:"upload-title"},[e._v("用户图片上传")]),""!=e.signImg?a("van-uploader",{attrs:{"before-read":e.beforeUploadImg,"after-read":e.uploadImg,"max-size":3145728},on:{oversize:e.onOversize}},[a("p",{staticClass:"upload-label"},[e._v("重新上传")])]):e._e()],1),a("van-col",{staticClass:"upload-right",attrs:{span:"14"}},[""==e.signImg?a("van-uploader",{staticStyle:{float:"right"},attrs:{"before-read":e.beforeUploadImg,"after-read":e.uploadImg,"max-size":3145728},on:{oversize:e.onOversize}},[a("van-button",{staticClass:"img-upload",attrs:{icon:"plus"}})],1):e._e(),""!=e.signImg?a("div",{staticClass:"sign-img"},[a("img",{attrs:{src:e.signImg},on:{click:function(t){return e.preview(e.signImg,0)}}})]):e._e()],1)],1),a("van-row",[a("van-col",{attrs:{offset:"12",span:"12"}},[a("p",{staticClass:"mini-font"},[e._v("文件大小3M以内")])])],1)],1):e._e(),a("div",{staticClass:"box2",staticStyle:{margin:"15px"}},[a("van-button",{staticClass:"button",attrs:{type:"info",size:"large",loading:e.loading},on:{click:e.submit}},[e._v("确认并收款")])],1)],1):!1===e.showForm?a("div"):a("div",{staticStyle:{"margin-top":"40%"}},[a("van-loading",{attrs:{type:"spinner",color:"#1989fa"}})],1)},r=[],i=(a("7f7f"),a("34ef"),a("4917"),a("28a5"),a("96cf"),a("3b8d")),s=a("cea2"),o=a("2b0e"),c=a("28a2"),l=a("2465"),u=a("91b6");o["a"].use(c["a"]);var m={name:"create",data:function(){return{loading:!1,showForm:!0,detail:{},customerName:"",customerPhone:"",customerCertNo:"",showPicker:!1,cashier:"请选择营业员",cashierCode:"",cashierList:[],storeNo:JSON.parse(localStorage.getItem("store")).storeNo,wayId:JSON.parse(localStorage.getItem("store")).wayId,tradeNo:"",newDate:(new Date).valueOf(),openImgState:!1,signImg:[]}},mounted:function(){this.detail=JSON.parse(localStorage.getItem("info")),this.getOpenImgState()},methods:{getOpenImgState:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t={},e.next=3,Object(l["e"])(t);case 3:a=e.sent,"20000"==a.data.code?this.openImgState=a.data.data:this.$toast({message:a.data.msg,icon:"warning-o"});case 5:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),onOversize:function(e){this.$toast({message:"文件大小不能超过3M",icon:"warning-o"})},beforeUploadImg:function(e){var t=e.size/1024/1024;if(t>3){var a=this;return new Promise(function(t){var n=new FileReader,r=document.createElement("canvas"),i=r.getContext("2d"),s=new Image;s.onload=function(n){var o=s.width,c=s.height;r.width=o,r.height=c,i.clearRect(0,0,o,c),i.drawImage(s,0,0,o,c);var l=r.toDataURL(e.type,.92),u=a.dataURLtoBlob(l,e.type);t(u)},n.onload=function(e){s.src=e.target.result},n.readAsDataURL(e)})}return!0},dataURLtoBlob:function(e){var t=e.split(","),a=t[0].match(/:(.*?);/)[1],n=atob(t[1]),r=n.length,i=new Uint8Array(r);while(r--)i[r]=n.charCodeAt(r);return new Blob([i],{type:a})},getUploadToken:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){var a,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(""!=this.customerPhone){e.next=3;break}return this.$toast({message:"请先填写手机号",icon:"warning-o"}),e.abrupt("return");case 3:return e.next=5,Object(u["a"])({outOrderNo:this.customerPhone+"_"+this.newDate,type:t});case 5:if(a=e.sent,n=a.data,"20000"!=n.code){e.next=11;break}return e.abrupt("return",n.data);case 11:this.$dialog.alert({message:n.msg});case 12:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),uploadToQiniu:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t,a,n,r,i){var o,c,l,u=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:o={useCdnDomain:!0,region:s["region"].z2},c={fname:t.name,params:{},mimeType:null},l=s["upload"](t,n,a,c,o),l.subscribe({next:function(e){console.log(e)},error:function(e){console.log(e),u.$dialog.alert({message:"上传失败，请重试"})},complete:function(e){u.signImg=r}});case 4:case"end":return e.stop()}},e)}));function t(t,a,n,r,i){return e.apply(this,arguments)}return t}(),uploadImg:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){var a,n,r,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return a=new FormData,a.append("file",t.file),n=t.file,e.next=5,this.getUploadToken("alipays");case 5:r=e.sent,r&&(i=r.host+r.key,this.uploadToQiniu(n,r.token,r.key,i,"alipays"));case 7:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),preview:function(e,t){var a=new Array;a.push(e),Object(c["a"])({images:a,showIndex:!1,loop:!1,startPosition:t})},showCashier:function(){var e=this,t={};t.storeNo=this.storeNo,Object(l["c"])(t).then(function(t){"20000"==t.data.code?(e.cashierList=t.data.data,e.cashierList.length>0?e.showPicker=!0:(e.showPicker=!1,e.$toast({message:"请先在门店管理后台添加收银员",icon:"warning-o"}))):e.$toast({message:t.data.msg,icon:"warning-o"})})},onConfirm:function(e){this.cashier=e.name,this.cashierCode=e.id,this.showPicker=!1},submit:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t,a,n,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t={},""!=this.customerName&&null!=this.customerName){e.next=4;break}return this.$toast({message:"客户姓名不能为空",icon:"warning-o"}),e.abrupt("return");case 4:if(""!=this.customerPhone&&null!=this.customerPhone){e.next=7;break}return this.$toast({message:"客户手机号不能为空",icon:"warning-o"}),e.abrupt("return");case 7:if(a=/^1[3456789]\d{9}$/,!1!==a.test(this.customerPhone)){e.next=11;break}return this.$toast({message:"手机号格式不正确",icon:"warning-o"}),e.abrupt("return");case 11:if(""!=this.customerCertNo&&null!=this.customerCertNo){e.next=14;break}return this.$toast({message:"身份证号不能为空",icon:"warning-o"}),e.abrupt("return");case 14:if(n=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/,!1!==n.test(this.customerCertNo)){e.next=18;break}return this.$toast({message:"身份证输入不合法",icon:"warning-o"}),e.abrupt("return");case 18:if(""!=this.cashierCode&&null!=this.cashierCode){e.next=21;break}return this.$toast({message:"请选择营业员",icon:"warning-o"}),e.abrupt("return");case 21:if(1!=this.openImgState){e.next=26;break}if(""!=this.signImg&&null!=this.signImg){e.next=25;break}return this.$toast({message:"请上传图片",icon:"warning-o"}),e.abrupt("return");case 25:t.customerImage=this.signImg;case 26:return t.mealId=this.detail.id,t.customerName=this.customerName,t.customerPhone=this.customerPhone,t.customerCertNo=this.customerCertNo,t.cashierId=this.cashierCode,t.wayId=this.wayId,t.storeNo=this.storeNo,e.next=35,Object(l["b"])(t);case 35:r=e.sent,"20000"==r.data.code?(this.tradeNo=r.data.data.tradeNo,this.$router.push({name:"pay",query:{tradeNo:this.tradeNo}})):this.$toast({message:r.data.msg,icon:"warning-o"});case 37:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()}},h=m,d=(a("a692"),a("2877")),p=Object(d["a"])(h,n,r,!1,null,"091ff66c",null);t["default"]=p.exports},55960:function(e,t,a){},a692:function(e,t,a){"use strict";var n=a("55960"),r=a.n(n);r.a}}]);